library(tidyverse)
library(tidyverse)
library(data.table)
# Colombia
process_orphans_colombia = function(){
country = 'colombia'
d_merge = read.csv('DATA/Colombia/colombia_all.csv', stringsAsFactors = FALSE)
d_children = read.csv(paste0('DATA/children/', country,'_children.csv'), stringsAsFactors = FALSE)
d_children$age = paste0(d_children$age%/%5 * 5,'-',d_children$age %/% 5 *5+4)
#d_children$age = paste0((d_children$age)%/%10 * 10 ,'-',(d_children$age) %/% 10 *10+9)
d_children$age = ifelse(d_children$age %in% c( '95-99','100+'), '95+', d_children$age)
d_children = d_children %>% group_by(age, gender) %>% mutate(nb_c = mean(children)) %>%
select(-children) %>% ungroup()%>%distinct()
d_merge$gender = as.character(d_merge$gender)
d_m1 = merge(d_merge, d_children, by = c('age', 'gender'))
d_m1 = as.data.table(d_m1)
d_m1[, orphans := round(deaths_2019 * nb_c)]
#d_m = merge(d_m1, f_ew, by = c('age', 'gender'))
d_m1$age = as.character(d_m1$age)
d_m1$age = ifelse(d_m1$age == '0-4', '00-04',
ifelse(d_m1$age == '5-9','05-09' ,d_m1$age))
d_m1 = d_m1%>% arrange(age)
write_csv(path = paste0('DATA/children/', country,'_orphans_all.csv'), d_m1)
p <- ggplot(d_m1, aes(x = age, y = orphans, fill = gender)) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw()+
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
xlab('Age of Parent') +
ylab('Number of Orphans')+
guides(fill=guide_legend(title="Sex of Parent"))
ggsave(filename = "figures/orphans_all_age_colombia.pdf", p, width = 6, height = 5)
#excess_death, total_covid19_deaths,
d_summary = d_m1 %>% select(age, gender, deaths_2019, orphans)
d_summary$age = ifelse(d_summary$age %in% c('00-04', '05-09', '10-14'), '0-14',
ifelse(d_summary$age %in% c('45-49','50-54', '55-59', '60-64'), '45-64',
ifelse(d_summary$age %in% c("65-69","70-74","75-79","80+" ),'65+', '15-44')))
d_summary = d_summary %>% group_by(age, gender) %>% mutate(#excess = sum(excess_death),
total_deaths = as.integer(round(sum(deaths_2019))),
nb_orphans = as.integer( round(sum(orphans)))) %>% ungroup() %>%
select(-orphans, -deaths_2019) %>%distinct()
#-excess_death, -total_covid19_deaths,
write_csv(path = 'DATA/Colombia/all_data.csv', d_summary)
d_summary %>% filter(age != '0-14') %>% group_by(gender) %>% mutate(#excess1 = round(sum(excess)),
deaths= round(sum(total_deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup()
}
process_orphans_colombia()
getwd()
setwd("C:/Users/40991/Desktop/project_wxy")
process_orphans_colombia()
