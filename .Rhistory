getwd()
setwd("C:/Users/40991/Desktop/project_wxy")
d_deaths = read.csv('DATA/England&Wales/death_all_england_wales.csv', stringsAsFactors = FALSE)
d_children = read.csv('DATA/children/england_wales_children.csv', stringsAsFactors = FALSE)
View(d_children)
View(d_deaths)
d_deaths = read.csv('DATA/England&Wales/death_all_england_wales.csv', stringsAsFactors = FALSE)
View(d_deaths)
d_children$age = paste0(d_children$age%/%5 * 5,'-',d_children$age %/% 5 *5+4)
d_children$age = ifelse(d_children$age %in% c('90-94', '95-99', '100-104'), '90+', d_children$age)
d_children = d_children %>% group_by(age, gender) %>% mutate(nb_c = mean(children)) %>%
select(-children) %>% ungroup()%>%distinct()
library(tidyverse)
d_children$age = paste0(d_children$age%/%5 * 5,'-',d_children$age %/% 5 *5+4)
d_children$age = ifelse(d_children$age %in% c('90-94', '95-99', '100-104'), '90+', d_children$age)
d_children = d_children %>% group_by(age, gender) %>% mutate(nb_c = mean(children)) %>%
select(-children) %>% ungroup()%>%distinct()
View(d_children)
d_deaths$Age = paste0(d_deaths$Age%/%5 * 5,'-',d_deaths$Age %/% 5 *5+4)
d_deaths$Age = ifelse(d_deaths$Age %in% c('90-94', '95-99', '100-104'), '90+', d_deaths$Age)
d_deaths = d_children %>% group_by(Age, gender) %>% mutate(nb_c = mean(deaths)) %>%
select(-deaths) %>% ungroup()%>%distinct()
d_deaths$Age = paste0(d_deaths$Age%/%5 * 5,'-',d_deaths$Age %/% 5 *5+4)
d_deaths$Age = ifelse(d_deaths$Age %in% c('90-94', '95-99', '100-104'), '90+', d_deaths$Age)
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(nb_c = mean(deaths)) %>%
select(-deaths) %>% ungroup()%>%distinct()
d_deaths$Age = paste0(d_deaths$Age%/%5 * 5,'-',d_deaths$Age %/% 5 *5+4)
d_deaths$Age = ifelse(d_deaths$Age %in% c('90-94', '95-99', '100-104'), '90+', d_deaths$Age)
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(nd_2015 = mean(X2015),
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019)) %>%
select(-deaths) %>% ungroup()%>%distinct()
d_deaths = read.csv('DATA/England&Wales/death_all_england_wales.csv', stringsAsFactors = FALSE)
d_deaths$Age = paste0(d_deaths$Age%/%5 * 5,'-',d_deaths$Age %/% 5 *5+4)
d_deaths$Age = ifelse(d_deaths$Age %in% c('90-94', '95-99', '100-104'), '90+', d_deaths$Age)
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(nd_2015 = mean(X2015),
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019)) %>%
select(-deaths) %>% ungroup()%>%distinct()
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(nd_2015 = mean(X2015),
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019))
warning(1)
warning()
warnings()
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(nd_2015 = mean(X2015),
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019)) %>%
select(-X2015) %>% ungroup()%>%distinct()
warnings()
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019)) %>%
select(-X2016) %>% ungroup()%>%distinct()
nd_2019=mean(X2019)) %>%
select(-X2016) %>% ungroup()%>%distinct()
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(
nd_2016=mean(X2016)
nd_2017=mean(X2017)
nd_2018=mean(X2018)
nd_2019=mean(X2019)) #%>%
d_deaths$Age = ifelse(d_deaths$Age %in% c('90-94', '95-99', '100-104','105-109'), '90+', d_deaths$Age)
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019)) %>%
select(-X2016) %>% ungroup()%>%distinct()
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019))# %>%
warnings()
type(d_deaths$X2019)
class(d_deaths$X2019)
d_deaths = read.csv('DATA/England&Wales/death_all_england_wales.csv')
d_deaths$Age = paste0(d_deaths$Age%/%5 * 5,'-',d_deaths$Age %/% 5 *5+4)
d_deaths$Age = ifelse(d_deaths$Age %in% c('90-94', '95-99', '100-104','105-109'), '90+', d_deaths$Age)
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019))# %>%
class(d_deaths$X2019)
mean(X2016)
mean(d_deaths$X2019)
# d_merge = d_deaths %>% group_by(age, gender) %>%
#   mutate(nb_covid19 = sum(covid19_deaths),
#          nb_excess = sum(excess_deaths)) %>%
#   ungroup() %>%
#   select(age, gender, nb_covid19, nb_excess) %>%
#   distinct()
#
# d_merge$deaths <- ifelse(d_merge$nb_excess > d_merge$nb_covid19, d_merge$nb_excess,  d_merge$nb_covid19)
# d_merge$gender = as.character(d_merge$gender)
#
d_children = read.csv('DATA/children/england_wales_children.csv', stringsAsFactors = FALSE)
class(d_children$children)
d_deaths$X2019 = as.numeric(d_deaths$X2019 )
d_deaths = read.csv('DATA/England&Wales/death_all_england_wales.csv', stringsAsFactors = FALSE)
d_deaths$Age = paste0(d_deaths$Age%/%5 * 5,'-',d_deaths$Age %/% 5 *5+4)
d_deaths$Age = ifelse(d_deaths$Age %in% c('90-94', '95-99', '100-104','105-109'), '90+', d_deaths$Age)
d_deaths$X2019 = as.numeric(d_deaths$X2019 )
d_deaths = read.csv('DATA/England&Wales/death_all_england_wales.csv', stringsAsFactors = FALSE)
d_deaths$X2019 = as.numeric(as.character(d_deaths$X2019) )
d_deaths = read.csv('DATA/England&Wales/death_all_england_wales.csv', stringsAsFactors = FALSE)
View(d_deaths)
View(d_deaths)
d_deaths_back = data.frame(d_deaths)
d_deaths_back$X2019=as.numeric(d_deaths_back$X2019)
d_deaths = read.csv('DATA/England&Wales/death_all_england_wales.csv', stringsAsFactors = FALSE)
d_deaths$Age = paste0(d_deaths$Age%/%5 * 5,'-',d_deaths$Age %/% 5 *5+4)
d_deaths$Age = ifelse(d_deaths$Age %in% c('90-94', '95-99', '100-104','105-109'), '90+', d_deaths$Age)
d_deaths_back = data.frame(d_deaths)
d_deaths_back$X2019=as.numeric(d_deaths_back$X2019)
class(d_deaths$X2019)
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(nd_2015=mean(X2015),
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019))# %>%
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(nd_2015=mean(X2015),
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019)) %>%
select(-X2016) %>% ungroup()%>%distinct()
d_deaths = read.csv('DATA/England&Wales/death_all_england_wales.csv', stringsAsFactors = FALSE)
d_deaths$Age = paste0(d_deaths$Age%/%5 * 5,'-',d_deaths$Age %/% 5 *5+4)
d_deaths$Age = ifelse(d_deaths$Age %in% c('90-94', '95-99', '100-104','105-109'), '90+', d_deaths$Age)
d_deaths = d_deaths %>% group_by(Age, gender) %>% mutate(nd_2015=mean(X2015),
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019)) %>%
select(-X2015,-X2016,-X2017,-X2018,-X2019) %>% ungroup()%>%distinct()
d_children = read.csv('DATA/children/england_wales_children.csv', stringsAsFactors = FALSE)
d_children$age = paste0(d_children$age%/%5 * 5,'-',d_children$age %/% 5 *5+4)
d_children$age = ifelse(d_children$age %in% c('90-94', '95-99', '100-104'), '90+', d_children$age)
d_children = d_children %>% group_by(age, gender) %>% mutate(nb_c = mean(children)) %>%
select(-children) %>% ungroup()%>%distinct()
d_children$age = ifelse(d_children$age == '0-4', '00-04',
ifelse(d_children$age == '5-9','05-09' , d_children$age))
d_deaths = read.csv('DATA/England&Wales/death_all_england_wales.csv', stringsAsFactors = FALSE)
d_deaths$age = paste0(d_deaths$age%/%5 * 5,'-',d_deaths$age %/% 5 *5+4)
d_deaths$age = ifelse(d_deaths$age %in% c('90-94', '95-99', '100-104','105-109'), '90+', d_deaths$age)
d_deaths = d_deaths %>% group_by(age, gender) %>% mutate(nd_2015=mean(X2015),
nd_2016=mean(X2016),
nd_2017=mean(X2017),
nd_2018=mean(X2018),
nd_2019=mean(X2019)) %>%
select(-X2015,-X2016,-X2017,-X2018,-X2019) %>% ungroup()%>%distinct()
d_m1 = merge(d_deaths, d_children, by = c('age', 'gender'))
View(d_m1)
View(d_m1)
d_m1 = as.data.table(d_m1)
library(data.table)
d_m1[, orphans_2015 := nd_2015 * nb_c, orphans_2016 := nd_2016 * nb_c,
orphans_2017 := nd_2017 * nb_c, orphans_2018 := nd_2018 * nb_c,
orphans_2019 := nd_2019 * nb_c]
d_m1[, orphans_2015 := nd_2015 * nb_c]
d_m1[, orphans_2015 = nd_2015 * nb_c]
d_m1[, orphans_2015 := nd_2015 * nb_c]
d_m1 = as.data.table(d_m1)
d_m1[, orphans_2015 := nd_2015 * nb_c]
View(d_m1)
View(d_m1)
d_m1 = merge(d_deaths, d_children, by = c('age', 'gender'))
d_m1 = as.data.table(d_m1)
d_m1[, orphans_2015 := nd_2015 * nb_c, orphans_2016 := nd_2016 * nb_c,
orphans_2017 := nd_2017 * nb_c, orphans_2018 := nd_2018 * nb_c,
orphans_2019 := nd_2019 * nb_c]
d_m1[, orphans_2015 := nd_2015 * nb_c]
d_m1[, orphans_2016 := nd_2016 * nb_c]
d_m1[, orphans_2017 := nd_2017 * nb_c]
d_m1[, orphans_2018 := nd_2018 * nb_c]
d_m1[, orphans_2019 := nd_2019 * nb_c]
View(d_m1)
write_csv(path = 'DATA/children/england_wales_orphans_all.csv', d_m1)
p <- ggplot(d_m1, aes(x = age, y = orphans_2015, fill = gender)) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw() +
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
#labs(x = 'Age of Parents', y = 'Fertility Rate per 1000 people')+
xlab( 'Age of Parent') +
ylab('Number of Orphans')+
guides(fill=guide_legend(title="Sex of Parent"))
p
p <- ggplot(d_m1, aes(x = age, y = orphans_2015, fill = gender)) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw() +
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
#labs(x = 'Age of Parents', y = 'Fertility Rate per 1000 people')+
xlab( 'Age of Parent') +
ylab('Number of Orphans in 2015')+
guides(fill=guide_legend(title="Sex of Parent"))
p
data_combine = read.csv('DATA/fertility/england_wales_fertility_all.csv')
data_combine$gender = ifelse(data_combine$gender == 'M', 'Male', 'Female')
names(data_combine)[which(names(data_combine) == 'rate')] = "fertility_rate"
View(data_combine)
############################################################################################
p <- ggplot(d_m1, aes(x = age, y = d_m1[,9:13], fill = gender)) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw() +
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
#labs(x = 'Age of Parents', y = 'Fertility Rate per 1000 people')+
xlab( 'Age of Parent') +
ylab('Number of Orphans in 2015')+
guides(fill=guide_legend(title="Sex of Parent"))
p
############################################################################################
p <- ggplot(d_m1, aes(x = age, y = d_m1[,9:13])) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw() +
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
#labs(x = 'Age of Parents', y = 'Fertility Rate per 1000 people')+
xlab( 'Age of Parent') +
ylab('Number of Orphans in 2015')+
guides(fill=guide_legend(title="Sex of Parent"))
############################################################################################
p <- ggplot(d_m1[,gender="female"], aes(x = age, y = d_m1[,9:13])) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw() +
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
#labs(x = 'Age of Parents', y = 'Fertility Rate per 1000 people')+
xlab( 'Age of Parent') +
ylab('Number of Orphans in 2015')+
guides(fill=guide_legend(title="Sex of Parent"))
############################################################################################
p <- ggplot(d_m1[,gender=="female"], aes(x = age, y = d_m1[,9:13])) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw() +
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
#labs(x = 'Age of Parents', y = 'Fertility Rate per 1000 people')+
xlab( 'Age of Parent') +
ylab('Number of Orphans in 2015')+
guides(fill=guide_legend(title="Sex of Parent"))
View(p)
############################################################################################
p <- ggplot(d_m1, aes(x = age, y = d_m1[,9:13])) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw() +
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
#labs(x = 'Age of Parents', y = 'Fertility Rate per 1000 people')+
xlab( 'Age of Parent') +
ylab('Number of Orphans in 2015')+
guides(fill=guide_legend(title="Sex of Parent"))
p
