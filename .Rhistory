getwd()
setwd("C:/Users/40991/Desktop/project_wxy")
source(file.path("script","process_children_function_xy.R"))
source(file.path("script","process_fertility_xy.R"))
source(file.path("script","process_child_mortality_xy.R"))
source(file.path("script","process_children_function_xy.R"))
source(file.path("script","process_fertility_xy.R"))
source(file.path("script","process_child_mortality_xy.R"))
# Germany
process_number_children_germany <- function(){
# fertility
cat(sprintf("Processing Fertility rates\n"))
process_germany_fertility()
# child mortality
cat(sprintf("Processing child mortality rates\n"))
process_child_mortality('germany', 'Germany')
# fathers
cat(sprintf("Processing number of children of fathers\n"))
data_f = read.csv(paste0('DATA/fertility/germany_fertility_m_all.csv'))
data_f$fertility_rate <- data_f$fertility_rate/1000
data_f$date = data_f$year
data_f$age = as.character(data_f$age)
process_children_father_65_plus("germany", data_f)
is_child_mortality_needed = 1
add_child_mortality(is_child_mortality_needed, "germany")
# mothers
cat(sprintf("Processing number of children of mothers\n"))
data = read.csv(paste0('DATA/fertility/germany_fertility_f.csv'))
data_f = copy(data)
data_f$fertility_rate = data_f$fertility_rate/1000
# d_2019 = data_f[which(data_f$date == '2019'),]
# d_2020 = copy(d_2019)
# d_2020$date = '2020'
# data_f = rbind(data_f, d_2020)
process_children_all("germany", is_child_mortality_needed, data_f)
cat(sprintf("Processing fertility rates\n"))
process_fertility_plots("germany")
}
process_number_children_germany()
source(file.path("script","process_children_function_xy.R"))
source(file.path("script","process_fertility_xy.R"))
source(file.path("script","process_child_mortality_xy.R"))
process_number_children_germany()
source(file.path("script","process_children_function_xy.R"))
source(file.path("script","process_fertility_xy.R"))
source(file.path("script","process_child_mortality_xy.R"))
process_number_children_germany()
process_children_mortality_update()
process_number_children_germany()
country = 'germany'
d_merge = read.csv('DATA/Germany/germany_all.csv', stringsAsFactors = FALSE)
d_children = read.csv(paste0('DATA/children/', country,'_children.csv'))
d_children$age = paste0(d_children$age%/%5 * 5,'-',d_children$age %/% 5 *5+4)
#d_children$age = paste0((d_children$age)%/%10 * 10 ,'-',(d_children$age) %/% 10 *10+9)
d_children$age = ifelse(d_children$age %in% c( '95-99','100+'), '95+', d_children$age)
d_children = d_children %>% group_by(age, gender) %>% mutate(nb_c = mean(children)) %>%
select(-children) %>% ungroup()%>%distinct()
d_merge$gender = as.character(d_merge$gender)
d_children$gender = ifelse(d_children$gender == 'female', 'Female', 'Male')
d_m1 = merge(d_merge, d_children, by = c('age', 'gender'))
d_m1 = as.data.table(d_m1)
d_m1[, orphans := round(deaths_2018 * nb_c)]
d_m1$age = as.character(d_m1$age)
#d_m1$age = ifelse(d_m1$age == '100+', '99+', d_m1$age)
d_m1 = d_m1%>% arrange(age)
write_csv(path = paste0('DATA/children/', country,'_orphans_all.csv'), d_m1)
p <- ggplot(d_m1, aes(x = age, y = orphans, fill = gender)) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw()+
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
xlab( 'Age of Parent') +
ylab('Number of Orphans')+
guides(fill=guide_legend(title="Sex of Parent"))
ggsave(filename = "figures/orphans_all_age_germany.pdf", p, width = 6, height = 5)
d_summary = d_m1 %>% select(age, gender, deaths_2018, orphans)
d_summary$age = as.character(d_summary$age)
d_summary$age = ifelse(d_summary$age %in% c('70-74','75-79', '80-84','85-89', '90-94','95+'), '70+',
ifelse(d_summary$age %in% c('50-54','55-59','60-64','65-69'), '50-69',
ifelse(d_summary$age %in% c('20-24','25-29', '30-34','35-39', '40-44','45-49'), '20-49','0-19')))
d_summary = d_summary %>% group_by(age, gender) %>%
mutate( COVID19_deaths = as.integer(round(sum(deaths))),
nb_orphans = as.integer(round(sum(orphans)))) %>% ungroup() %>%
select(-orphans, -deaths) %>%distinct()
d_summary = d_summary %>% group_by(age, gender) %>%
mutate( COVID19_deaths = as.integer(round(sum(deaths_2018))),
nb_orphans = as.integer(round(sum(orphans)))) %>% ungroup() %>%
select(-orphans, -deaths_2018) %>%distinct()
write_csv(path = 'DATA/Germany/all_data.csv', d_summary)
d_summary %>% filter(age != '0-19') %>% group_by(gender) %>%
mutate(covid19 = round(sum(COVID19_deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup()
d_summary = d_summary %>% group_by(age, gender) %>%
mutate( num_deaths = as.integer(round(sum(deaths_2018))),
nb_orphans = as.integer(round(sum(orphans)))) %>% ungroup() %>%
select(-orphans, -deaths_2018) %>%distinct()
write_csv(path = 'DATA/Germany/all_data.csv', d_summary)
d_summary %>% filter(age != '0-19') %>% group_by(gender) %>%
mutate(deaths = round(sum(deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup()
d_summary = d_m1 %>% select(age, gender, deaths_2018, orphans)
d_summary$age = as.character(d_summary$age)
d_summary$age = ifelse(d_summary$age %in% c('70-74','75-79', '80-84','85-89', '90-94','95+'), '70+',
ifelse(d_summary$age %in% c('50-54','55-59','60-64','65-69'), '50-69',
ifelse(d_summary$age %in% c('20-24','25-29', '30-34','35-39', '40-44','45-49'), '20-49','0-19')))
d_summary = d_summary %>% group_by(age, gender) %>%
mutate( num_deaths = as.integer(round(sum(deaths_2018))),
nb_orphans = as.integer(round(sum(orphans)))) %>% ungroup() %>%
select(-orphans, -deaths_2018) %>%distinct()
write_csv(path = 'DATA/Germany/all_data.csv', d_summary)
d_summary %>% filter(age != '0-19') %>% group_by(gender) %>%
mutate(deaths = round(sum(deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup()
d_summary %>% filter(age != '0-19') %>% group_by(gender) %>%
mutate(deaths = round(sum(num_deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup()
source(file.path("script","process_children_function_xy.R"))
source(file.path("script","process_fertility_xy.R"))
source(file.path("script","process_child_mortality_xy.R"))
process_number_children_mexico <- function(){
# fertility
cat(sprintf("Processing Fertility rates\n"))
process_mexico_fertility()
# child mortality
cat(sprintf("Processing child mortality rates\n"))
process_child_mortality('mexico', 'Mexico')
# fathers
cat(sprintf("Processing number of children of fathers\n"))
data_f = read.csv(paste0('DATA/fertility/mexico_fertility_m_all.csv'))
data_f$fertility_rate <- data_f$fertility_rate/1000
data_f$date = data_f$year
data_f$age = as.character(data_f$age)
process_children_father_65_plus("mexico", data_f)
is_child_mortality_needed = 1
add_child_mortality(is_child_mortality_needed, "mexico")
# mothers
cat(sprintf("Processing number of children of mothers\n"))
data = read.csv(paste0('DATA/fertility/mexico_fertility_f.csv'))
data_f = copy(data)
data_f$fertility_rate = data_f$fertility_rate/1000
# d_2019 = data_f[which(data_f$date == '2019'),]
# d_2020 = copy(d_2019)
# d_2020$date = '2020'
# data_f = rbind(data_f, d_2020)
process_children_all("mexico", is_child_mortality_needed, data_f)
process_fertility_plots("mexico")
}
process_number_children_mexico()
process_orphans_mexico = function(){
country = 'mexico'
d_deaths = read.csv('DATA/Mexico/mexico_all.csv', stringsAsFactors = FALSE)
d_merge = copy(d_deaths)
d_children = read.csv(paste0('DATA/children/', country,'_children.csv'), stringsAsFactors = FALSE)
d_children$age = paste0(d_children$age%/%5 * 5,'-',d_children$age %/% 5 *5+4)
#d_children$age = paste0((d_children$age)%/%10 * 10 ,'-',(d_children$age) %/% 10 *10+9)
d_children$age = ifelse(d_children$age %in% c( '95-99','100+'), '95+', d_children$age)
d_children = d_children %>% group_by(age, gender) %>% mutate(nb_c = mean(children)) %>%
select(-children) %>% ungroup()%>%distinct()
d_merge$gender = as.character(d_merge$gender)
d_children$gender = ifelse(d_children$gender == 'female', 'Female', 'Male')
d_m1 = merge(d_merge, d_children, by = c('age', 'gender'))
d_m1 = as.data.table(d_m1)
d_m1[, orphans := round(deaths_2018 * nb_c)]
d_m1$age = as.character(d_m1$age)
d_m1$age = ifelse(d_m1$age == '0-4', '00-04',
ifelse(d_m1$age == '5-9','05-09' ,d_m1$age))
d_m1 = d_m1%>% arrange(age)
write_csv(path = paste0('DATA/children/', country,'_orphans_all.csv'), d_m1)
p <- ggplot(d_m1, aes(x = age, y = orphans, fill = gender)) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw()+
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
xlab( 'Age of Parent') +
ylab('Number of Orphans')+
guides(fill=guide_legend(title="Sex of Parent"))
ggsave(filename = "figures/orphans_all_age_mexico.pdf", p, width = 6, height = 5)
d_summary = d_m1 %>% select(age, gender, deaths_2018, orphans)
d_summary$age = as.character(d_summary$age)
d_summary$age = ifelse(d_summary$age %in% c('70-74','75-79', '80-84','85-89', '90-94','95+'), '70+',
ifelse(d_summary$age %in% c('50-54','55-59','60-64','65-69'), '50-69',
ifelse(d_summary$age %in% c('20-24','25-29', '30-34','35-39', '40-44','45-49'), '20-49','0-19')))
d_summary = d_summary %>% group_by(age, gender) %>%
mutate( deaths = as.integer(round(sum(deaths_2018))),
nb_orphans = as.integer(round(sum(orphans)))) %>% ungroup() %>%
select(-orphans, -deaths) %>%distinct()
write_csv(path = 'DATA/Mexico/all_data.csv', d_summary)
d_summary %>% filter(age != '0-14') %>% group_by(gender) %>%
mutate(num_deaths = round(sum(deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup()
}
process_orphans_mexico()
country = 'mexico'
d_deaths = read.csv('DATA/Mexico/mexico_all.csv', stringsAsFactors = FALSE)
d_merge = copy(d_deaths)
d_children = read.csv(paste0('DATA/children/', country,'_children.csv'), stringsAsFactors = FALSE)
d_children$age = paste0(d_children$age%/%5 * 5,'-',d_children$age %/% 5 *5+4)
#d_children$age = paste0((d_children$age)%/%10 * 10 ,'-',(d_children$age) %/% 10 *10+9)
d_children$age = ifelse(d_children$age %in% c( '95-99','100+'), '95+', d_children$age)
d_children = d_children %>% group_by(age, gender) %>% mutate(nb_c = mean(children)) %>%
select(-children) %>% ungroup()%>%distinct()
d_merge$gender = as.character(d_merge$gender)
d_children$gender = ifelse(d_children$gender == 'female', 'Female', 'Male')
d_m1 = merge(d_merge, d_children, by = c('age', 'gender'))
d_m1 = as.data.table(d_m1)
d_m1[, orphans := round(deaths_2018 * nb_c)]
d_m1$age = as.character(d_m1$age)
d_m1$age = ifelse(d_m1$age == '0-4', '00-04',
ifelse(d_m1$age == '5-9','05-09' ,d_m1$age))
d_m1 = d_m1%>% arrange(age)
write_csv(path = paste0('DATA/children/', country,'_orphans_all.csv'), d_m1)
p <- ggplot(d_m1, aes(x = age, y = orphans, fill = gender)) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw()+
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
xlab( 'Age of Parent') +
ylab('Number of Orphans')+
guides(fill=guide_legend(title="Sex of Parent"))
ggsave(filename = "figures/orphans_all_age_mexico.pdf", p, width = 6, height = 5)
d_summary = d_m1 %>% select(age, gender, deaths_2018, orphans)
d_summary$age = as.character(d_summary$age)
d_summary$age = ifelse(d_summary$age %in% c('70-74','75-79', '80-84','85-89', '90-94','95+'), '70+',
ifelse(d_summary$age %in% c('50-54','55-59','60-64','65-69'), '50-69',
ifelse(d_summary$age %in% c('20-24','25-29', '30-34','35-39', '40-44','45-49'), '20-49','0-19')))
d_summary = d_summary %>% group_by(age, gender) %>%
mutate( deaths = as.integer(round(sum(deaths_2018))),
nb_orphans = as.integer(round(sum(orphans)))) %>% ungroup() %>%
select(-orphans, -deaths) %>%distinct()
write_csv(path = 'DATA/Mexico/all_data.csv', d_summary)
d_summary %>% filter(age != '0-14') %>% group_by(gender) %>%
mutate(num_deaths = round(sum(deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup()
d_summary %>% filter(age != '0-19') %>% group_by(gender) %>%
mutate(num_deaths = round(sum(deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup()
View(d_summary)
View(d_deaths)
process_orphans_mexico()
country = 'mexico'
d_deaths = read.csv('DATA/Mexico/mexico_all.csv', stringsAsFactors = FALSE)
d_merge = copy(d_deaths)
d_children = read.csv(paste0('DATA/children/', country,'_children.csv'), stringsAsFactors = FALSE)
d_children$age = paste0(d_children$age%/%5 * 5,'-',d_children$age %/% 5 *5+4)
#d_children$age = paste0((d_children$age)%/%10 * 10 ,'-',(d_children$age) %/% 10 *10+9)
d_children$age = ifelse(d_children$age %in% c( '95-99','100+'), '95+', d_children$age)
d_children = d_children %>% group_by(age, gender) %>% mutate(nb_c = mean(children)) %>%
select(-children) %>% ungroup()%>%distinct()
d_merge$gender = as.character(d_merge$gender)
d_children$gender = ifelse(d_children$gender == 'female', 'Female', 'Male')
d_m1 = merge(d_merge, d_children, by = c('age', 'gender'))
d_m1 = as.data.table(d_m1)
d_m1[, orphans := round(deaths_2018 * nb_c)]
d_m1$age = as.character(d_m1$age)
d_m1$age = ifelse(d_m1$age == '0-4', '00-04',
ifelse(d_m1$age == '5-9','05-09' ,d_m1$age))
d_m1 = d_m1%>% arrange(age)
write_csv(path = paste0('DATA/children/', country,'_orphans_all.csv'), d_m1)
p <- ggplot(d_m1, aes(x = age, y = orphans, fill = gender)) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw()+
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
xlab( 'Age of Parent') +
ylab('Number of Orphans')+
guides(fill=guide_legend(title="Sex of Parent"))
ggsave(filename = "figures/orphans_all_age_mexico.pdf", p, width = 6, height = 5)
d_summary = d_m1 %>% select(age, gender, deaths_2018, orphans)
d_summary$age = as.character(d_summary$age)
d_summary$age = ifelse(d_summary$age %in% c('70-74','75-79', '80-84','85-89', '90-94','95+'), '70+',
ifelse(d_summary$age %in% c('50-54','55-59','60-64','65-69'), '50-69',
ifelse(d_summary$age %in% c('20-24','25-29', '30-34','35-39', '40-44','45-49'), '20-49','0-19')))
d_summary = d_summary %>% group_by(age, gender) %>%
mutate( deaths = as.integer(round(sum(deaths_2018))),
nb_orphans = as.integer(round(sum(orphans)))) %>% ungroup() %>%
select(-orphans, -deaths) %>%distinct()
write_csv(path = 'DATA/Mexico/all_data.csv', d_summary)
d_summary %>% filter(age != '0-19') %>% group_by(gender) %>%
mutate(num_deaths = round(sum(deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup()
d_summary = d_m1 %>% select(age, gender, deaths_2018, orphans)
d_summary$age = as.character(d_summary$age)
d_summary$age = ifelse(d_summary$age %in% c('70-74','75-79', '80-84','85-89', '90-94','95+'), '70+',
ifelse(d_summary$age %in% c('50-54','55-59','60-64','65-69'), '50-69',
ifelse(d_summary$age %in% c('20-24','25-29', '30-34','35-39', '40-44','45-49'), '20-49','0-19')))
d_summary = d_summary %>% group_by(age, gender) %>%
mutate( num_deaths = as.integer(round(sum(deaths_2018))),
nb_orphans = as.integer(round(sum(orphans)))) %>% ungroup() %>%
select(-orphans, -deaths_2018) %>%distinct()
write_csv(path = 'DATA/Mexico/all_data.csv', d_summary)
d_summary %>% filter(age != '0-19') %>% group_by(gender) %>%
mutate(deaths = round(sum(num_deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup()
data_fertility = read.csv('DATA/fertility_update/parents_live_births.csv')
data_fertility = data_fertility %>% filter(country == 'Poland',
age != 'Unknown - Inconnu',
gender == 'Male')
data_pop = readxl::read_xlsx('DATA/fertility_update/pop.xlsx', sheet = 2)
View(data_fertility)
View(data_pop)
source(file.path("script","process_children_function_xy.R"))
source(file.path("script","process_fertility_xy.R"))
source(file.path("script","process_child_mortality_xy.R"))
process_number_children_poland <- function(){
# fertility
cat(sprintf("Processing Fertility rates\n"))
process_poland_fertility()
# child mortality
cat(sprintf("Processing child mortality rates\n"))
process_child_mortality('poland', 'Poland')
# fathers
cat(sprintf("Processing number of children of fathers\n"))
data_f = read.csv(paste0('DATA/fertility/poland_fertility_m_all.csv'))
data_f$fertility_rate <- data_f$fertility_rate/1000
data_f$date = data_f$year
data_f$age = as.character(data_f$age)
process_children_father_50_plus("poland", data_f)
is_child_mortality_needed = 1
add_child_mortality(is_child_mortality_needed, "poland")
# mothers
cat(sprintf("Processing number of children of mothers\n"))
data = read.csv(paste0('DATA/fertility/poland_fertility_f.csv'))
data_f = copy(data)
data_f$fertility_rate = data_f$fertility_rate/1000
# d_2019 = data_f[which(data_f$date == '2019'),]
# d_2020 = copy(d_2019)
# d_2020$date = '2020'
# data_f = rbind(data_f, d_2020)
process_children_all("poland", is_child_mortality_needed, data_f)
process_fertility_plots("poland")
}
process_number_children_poland()
source(file.path("script","process_children_function_xy.R"))
source(file.path("script","process_fertility_xy.R"))
source(file.path("script","process_child_mortality_xy.R"))
process_number_children_poland <- function(){
# fertility
cat(sprintf("Processing Fertility rates\n"))
process_poland_fertility()
# child mortality
cat(sprintf("Processing child mortality rates\n"))
process_child_mortality('poland', 'Poland')
# fathers
cat(sprintf("Processing number of children of fathers\n"))
data_f = read.csv(paste0('DATA/fertility/poland_fertility_m_all.csv'))
data_f$fertility_rate <- data_f$fertility_rate/1000
data_f$date = data_f$year
data_f$age = as.character(data_f$age)
process_children_father_50_plus("poland", data_f)
is_child_mortality_needed = 1
add_child_mortality(is_child_mortality_needed, "poland")
# mothers
cat(sprintf("Processing number of children of mothers\n"))
data = read.csv(paste0('DATA/fertility/poland_fertility_f.csv'))
data_f = copy(data)
data_f$fertility_rate = data_f$fertility_rate/1000
# d_2019 = data_f[which(data_f$date == '2019'),]
# d_2020 = copy(d_2019)
# d_2020$date = '2020'
# data_f = rbind(data_f, d_2020)
process_children_all("poland", is_child_mortality_needed, data_f)
process_fertility_plots("poland")
}
process_number_children_poland()
country = 'poland'
d_deaths = read.csv('DATA/Poland/poland_all.csv', stringsAsFactors = FALSE)
d_merge = copy(d_deaths)
d_children = read.csv(paste0('DATA/children/', country,'_children.csv'), stringsAsFactors = FALSE)
d_children$age = paste0(d_children$age%/%5 * 5,'-',d_children$age %/% 5 *5+4)
#d_children$age = paste0((d_children$age)%/%10 * 10 ,'-',(d_children$age) %/% 10 *10+9)
d_children$age = ifelse(d_children$age %in% c( '95-99','100+'), '95+', d_children$age)
d_children = d_children %>% group_by(age, gender) %>% mutate(nb_c = mean(children)) %>%
select(-children) %>% ungroup()%>%distinct()
d_merge$gender = as.character(d_merge$gender)
d_children$gender = ifelse(d_children$gender == 'female', 'Female', 'Male')
d_m1 = merge(d_merge, d_children, by = c('age', 'gender'))
d_m1 = as.data.table(d_m1)
d_m1[, orphans := round(deaths_2018 * nb_c)]
d_m1 = d_m1%>% arrange(age)
write_csv(path = paste0('DATA/children/', country,'_orphans_all.csv'), d_m1)
d_m1$age = factor(d_m1$age, levels = c('0-4','5-9','10-14','15-19','20-24',
'25-29', '30-34','35-39', '40-44','45-49',
'50-54','55-59','60-64','65-69',
'70-74','75-79', '80-84','85-89',
'90-94','95+'))
p <- ggplot(d_m1, aes(x = age, y = orphans, fill = gender)) +
geom_bar(stat="identity", position=position_dodge()) +
theme_bw()+
theme(axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1))+
xlab( 'Age of Parent') +
ylab('Number of Orphans')+
guides(fill=guide_legend(title="Sex of Parent"))
ggsave(filename = "figures/orphans_all_age_spain.pdf", p, width = 6, height = 5)
d_summary = d_m1 %>% select(age, gender,  deaths_2018, orphans)
d_summary$age = as.character(d_summary$age)
d_summary$age = ifelse(d_summary$age %in% c('70-74','75-79', '80-84','85-89', '90-94','95+'), '70+',
ifelse(d_summary$age %in% c('50-54','55-59','60-64','65-69'), '50-69',
ifelse(d_summary$age %in% c('20-24','25-29', '30-34','35-39', '40-44','45-49'), '20-49','0-19')))
d_summary = d_summary %>% group_by(age, gender) %>%
mutate(max_deaths = as.integer(round((sum(deaths_2018)))),
nb_orphans = as.integer(round(sum(orphans)))) %>% ungroup() %>%
select(-orphans, -deaths_2018) %>%distinct()
write_csv(path = 'DATA/Spain/all_data.csv', d_summary)
as.data.frame(d_summary %>% filter(age != '0-19') %>% group_by(gender) %>%
mutate(total_deaths= round(sum(max_deaths)),
orphans= round( sum( nb_orphans))) %>% ungroup())
}
ggsave(filename = "figures/orphans_all_age_poland.pdf", p, width = 6, height = 5)
